<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: mouse.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: mouse.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module mouse 
 * @description Contains current mouse state,
 * functions to update state trough mouse events,
 * helps to find clicked 3D object
 */

import THREE from 'three';

import * as camera from './camera';

/** Keys states */
export var keys = {};

/** Delta X - horisontal distance between two move events */
export var dX = null;

/** Delta Y - vertical distance between two move events */
export var dY = null;

/** Horisontal distance of mouse pointer to canvas center */
export var longX = null;

/** Vertical distance of mouse pointer to canvas center */
export var longY = null;

var x = null;
var y = null;
var target = null;

/** Last down or move event target
 * @returns target
 */
export function getTarget() {
	return target;
}

/** Update current state by onmousedown event
 * @param event
 */
export function down(event) {
	if(event) {
		keys[event.which] = true;
		target = event.target;
		x = event.offsetX;
		y = event.offsetY;
		longX = getWidth() * 0.5 - x;
		longY = getHeight() * 0.5 - y;
	}
}

/** Update current state by onmouseup event
 * @param event
 */
export function up(event) {
	if(event) {
		keys[event.which] = false;
		// linux chrome bug fix (when both keys release then both event.which equal 3)
		keys[1] = false; 
	}
}

/** Update current state by onmousemove event
 * @param event
 */
export function move(event) {
	if(event) {
		target = event.target;
		longX = getWidth() * 0.5 - x;
		longY = getHeight() * 0.5 - y;
		dX = event.offsetX - x;
		dY = event.offsetY - y;
		x = event.offsetX;
		y = event.offsetY;
	}
}

/**
 * @param {Array} objects - Objects to check for collisions
 * @param {Boolean} recursive - Recursive check
 * @param {Array} searchFor - Array of classes to check
 * @returns {Object} The closest intersected object
 * 
 * @example 
 * var intersected = lib3d.mouse.getIntersected(lib3d.environment.library.children, true, [BookObject]);
 * //intersected.object is an instance of BookObject
 */
export function getIntersected(objects, recursive, searchFor) {
	var
		vector,
		raycaster,
		intersects,
		intersected,
		result,
		i, j;

	result = null;
	vector = getVector();
	raycaster = new THREE.Raycaster();
	raycaster.set(camera.getPosition(), vector);
	intersects = raycaster.intersectObjects(objects, recursive);

	if(searchFor) {
		if(intersects.length) {
			for(i = 0; i &lt; intersects.length; i++) {
				intersected = intersects[i];
				
				for(j = searchFor.length - 1; j >= 0; j--) {
					if(intersected.object instanceof searchFor[j]) {
						result = intersected;
						break;
					}
				}

				if(result) {
					break;
				}
			}
		}		
	} else {
		result = intersects;
	}

	return result;
}

function getVector() {
	var vector = new THREE.Vector3((x / getWidth()) * 2 - 1, - (y / getHeight()) * 2 + 1, 0.5);
	vector.unproject(camera.camera);

	return vector.sub(camera.getPosition()).normalize();
}

function getWidth() {
	return camera.width;
}

function getHeight() {
	return camera.height;
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-camera.html">camera</a></li><li><a href="module-environment.html">environment</a></li><li><a href="module-lib3d.html">lib3d</a></li><li><a href="module-locator.html">locator</a></li><li><a href="module-mouse.html">mouse</a></li><li><a href="module-navigation.html">navigation</a></li><li><a href="module-preview.html">preview</a></li><li><a href="module-selector.html">selector</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue Jan 26 2016 11:33:57 GMT+0300 (Belarus Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
