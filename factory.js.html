<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: factory.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: factory.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module factory
 * @description Builds 3d objects
 */
import THREE from 'three';

import BookMaterial from './materials/BookMaterial';
import LibraryObject from './models/LibraryObject';
import BookObject from './models/BookObject';
import SectionObject from './models/SectionObject';

import * as repository from './repository';

/**
 * @param {Object} dto - Library dto
 * @returns {LibraryObject} An instance of LibraryObject
 */
export function createLibrary(dto) {
    var libraryData = repository.getLibraryData(dto.model);

    if (!libraryData) {
        console.error(`Library ${dto.model} not found.`);
        return null;
    }

    return buildLibrary(libraryData, dto);
}

/**
 * @param {Object} dto - Section dto
 * @returns {SectionObject} An instance of SectionObject
 */
export function createSection(dto) {
    var sectionData = repository.getSectionData(dto.model);
    //TODO: separate params from dto
    dto.data = sectionData.params;

    if (!sectionData) {
        console.error(`Section ${dto.model} not found.`);
        return null;
    }

    return buildSection(sectionData, dto);
}

/**
 * @param {Object} dto - Book dto
 * @returns {BookObject} An instance of BookObject
 */
export function createBook(dto) {
	var bookData = repository.getBookData(dto.model);
    var book;

    if (!bookData) {
        console.error(`Book ${dto.model} not found.`);
        return null;
    }

	book = new BookObject(dto, bookData.geometry);

	Promise.all([
		bookData.asyncData,
		dto.cover ? repository.loadImage(dto.cover.url) : Promise.resolve(null)
	]).then(results => {
		book.material = new BookMaterial(results[0].map, results[0].bumpMap, results[0].specularMap, results[1]);
	});

	return book;
}

function buildLibrary(libraryData, dto) {
    var library = new LibraryObject(dto, libraryData.geometry);
    library.add(new THREE.AmbientLight(0x333333));

    libraryData.asyncData
        .then(data => {
            let texture = new THREE.Texture(data.map);
            texture.needsUpdate = true;

            library.material = new THREE.MeshPhongMaterial({map: texture});
        });

	return library;
}

function buildSection(sectionData, dto) {
    var section = new SectionObject(dto, sectionData.geometry);

    sectionData.asyncData
        .then(data => {
            let texture = new THREE.Texture(data.map);
            texture.needsUpdate = true;

            section.material = new THREE.MeshPhongMaterial({map: texture});
        });

	return section;
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-camera.html">camera</a></li><li><a href="module-environment.html">environment</a></li><li><a href="module-factory.html">factory</a></li><li><a href="module-lib3d.html">lib3d</a></li><li><a href="module-loader.html">loader</a></li><li><a href="module-locator.html">locator</a></li><li><a href="module-mouse.html">mouse</a></li><li><a href="module-navigation.html">navigation</a></li><li><a href="module-preview.html">preview</a></li><li><a href="module-selector.html">selector</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CLEARANCE">CLEARANCE</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Mar 23 2016 11:56:37 GMT+0300 (Belarus Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
